<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>¡Feliz Año Nuevo, Rosario! ❤️</title>
    <!-- Importación de fuentes elegantes desde Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Parisienne&display=swap" rel="stylesheet">
    <style>
        /* RESET BÁSICO Y ESTILOS GLOBALES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #020024;
        }

        /* FONDO NOCTURNO CON DEGRADADO ELEGANTE */
        .night-sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #020024 0%, #090979 60%, #000000 100%);
            z-index: -1;
        }

        /* CONTENEDOR PRINCIPAL */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            pointer-events: none; /* Los clicks pasan al canvas */
            z-index: 10;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            display: block;
        }

        /* TEXTO PRINCIPAL CON ANIMACIÓN DE LATIDO */
        .main-title {
            font-family: 'Great Vibes', cursive;
            color: #ffffff;
            text-align: center;
            font-size: clamp(2.5rem, 10vw, 5.5rem);
            text-shadow: 
                0 0 10px rgba(255, 215, 0, 0.8),
                0 0 20px rgba(255, 105, 180, 0.6),
                0 0 30px rgba(255, 255, 255, 0.4);
            animation: pulse 3s ease-in-out infinite;
            padding: 20px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; text-shadow: 0 0 40px rgba(255, 105, 180, 0.9), 0 0 60px rgba(255, 215, 0, 0.5); }
        }

        /* CONTENEDOR DE FRASES ROMÁNTICAS */
        #message-container {
            position: absolute;
            bottom: 8%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Parisienne', cursive;
            color: rgba(255, 255, 255, 0.85);
            font-size: clamp(1.2rem, 5vw, 2.2rem);
            text-align: center;
            width: 80%;
            opacity: 0;
            transition: opacity 1s ease-in-out, transform 1s ease-in-out;
            pointer-events: none;
        }

        #message-container.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        /* INSTRUCCIÓN INICIAL */
        .instruction {
            position: absolute;
            top: 70%;
            font-family: 'Parisienne', cursive;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.2rem;
            animation: fadeInOut 4s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.8; }
        }

        /* CONTROLES (AUDIO Y CARTA) */
        .ui-button {
            position: fixed;
            top: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 105, 180, 0.5);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.3);
        }

        .ui-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(255, 105, 180, 0.6);
        }

        .ui-button svg {
            fill: #ffffff;
            width: 24px;
            height: 24px;
        }

        #audio-control { right: 20px; }
        #letter-control { left: 20px; }

        /* MODAL DE LA CARTA */
        #letter-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none; /* Oculto por defecto */
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #letter-modal.active {
            display: flex;
            opacity: 1;
        }

        .letter-paper {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            border-radius: 25px;
            padding: 40px 30px;
            position: relative;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.8);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #letter-modal.active .letter-paper {
            transform: scale(1);
        }

        .letter-text {
            font-family: 'Parisienne', cursive;
            color: #f0f0f0;
            font-size: clamp(1.2rem, 4.5vw, 1.5rem);
            line-height: 1.8;
            text-align: center;
            white-space: pre-wrap; /* Mantiene saltos de línea */
        }

        .close-letter {
            position: absolute;
            top: 15px;
            right: 20px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            font-family: Arial, sans-serif;
            opacity: 0.7;
        }

        .close-letter:hover { opacity: 1; }

        /* Scrollbar elegante para el modal */
        .letter-paper::-webkit-scrollbar { width: 5px; }
        .letter-paper::-webkit-scrollbar-thumb { background: rgba(255, 105, 180, 0.5); border-radius: 10px; }
    </style>
</head>
<body>

    <div class="night-sky"></div>
    
    <canvas id="fireworksCanvas"></canvas>

    <div id="ui-layer">
        <h1 class="main-title">¡Feliz Año Nuevo, Rosario! ❤️</h1>
        <div class="instruction">Toca la pantalla para celebrar...</div>
        <div id="message-container"></div>
    </div>

    <!-- BOTÓN DE CARTA -->
    <div id="letter-control" class="ui-button" title="Leer carta">
        <svg viewBox="0 0 24 24"><path d="M20,4L12,11L4,4V20H20V4M20,2A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4A2,2 0 0,1 2,20V4A2,2 0 0,1 4,2H20M4.89,6L12,12.21L19.11,6H4.89Z" /></svg>
    </div>

    <!-- CONTROL DE VOLUMEN -->
    <div id="audio-control" class="ui-button" title="Activar/Desactivar música">
        <svg id="icon-sound-on" viewBox="0 0 24 24"><path d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.03,19.86 21,16.28 21,12C21,7.72 18.03,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16.02C15.5,15.29 16.5,13.77 16.5,12M3,9V15H7L12,20V4L7,9H3Z" /></svg>
        <svg id="icon-sound-off" style="display: none;" viewBox="0 0 24 24"><path d="M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18.03,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,10.23 15.5,8.71 14,7.97V10.18L16.45,12.63C16.48,12.43 16.5,12.22 16.5,12Z" /></svg>
    </div>

    <!-- MODAL DE LA CARTA -->
    <div id="letter-modal">
        <div class="letter-paper" id="letter-paper">
            <span class="close-letter" id="close-letter">&times;</span>
            <div class="letter-text">
Ahora que el año deshoja sus últimos instantes y el mundo se pierde en el estruendo de los festejos, yo encuentro mi paz absoluta en la certeza de tenerte. Al mirar atrás, no contabilizo el tiempo en horas, sino en los momentos en que tu presencia transformó mi realidad, convirtiendo la simple cotidianidad en algo verdaderamente sublime.

Posees esa inefable virtud de ser faro en mis tormentas y sosiego en mis días vorágines. Eres la arquitectura de mis mejores recuerdos y el cimiento sólido sobre el que proyecto mis esperanzas. No te amo solo por quien eres, sino por la versión de mí mismo que florece cuando estoy a tu lado; una versión más valiente, más plena y más humana.

Ante el horizonte de este nuevo ciclo que aguarda, no pido un destino exento de desafíos, pues la perfección es estática; pido simplemente que cada amanecer me encuentre buscando tu mirada. Que tengamos la sabiduría para sortear las adversidades y la sensibilidad para valorar las pequeñas victorias que edifican nuestro amor.

Que este Año Nuevo sea el lienzo donde sigamos trazando nuestra historia: imperfecta, real, pero absolutamente nuestra. Gracias por ser, por estar y por coincidir conmigo en este vasto universo.

Feliz Año Nuevo, mi chihuhua bomnita
            </div>
        </div>
    </div>

    <!-- MÚSICA DE FONDO -->
    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/audio/2022/02/07/audio_10499696a4.mp3" type="audio/mpeg">
    </audio>

    <script>
        /**
         * CONFIGURACIÓN DE MENSAJES
         */
        const messages = [
            "Eres mi deseo de medianoche",
            "Por un 2025 lleno de nuestro amor",
            "Te amo más cada año, Rosario",
            "Eres la magia de mi vida",
            "Juntos es mi lugar favorito",
            "Gracias por iluminar mis días",
            "Mi mejor regalo eres tú",
            "Eres mi estrella más brillante"
        ];

        const colors = [
            '#ff69b4', '#ff0000', '#ffd700', '#8a2be2', '#ffffff', '#ff1493'
        ];

        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        const messageEl = document.getElementById('message-container');
        const bgMusic = document.getElementById('bg-music');
        const audioControl = document.getElementById('audio-control');
        const letterControl = document.getElementById('letter-control');
        const letterModal = document.getElementById('letter-modal');
        const closeLetter = document.getElementById('close-letter');
        const letterPaper = document.getElementById('letter-paper');
        
        const iconOn = document.getElementById('icon-sound-on');
        const iconOff = document.getElementById('icon-sound-off');
        
        let particles = [];
        let messageTimeout;
        let musicStarted = false;
        let isModalOpen = false;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor(x, y, vx, vy, color) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.color = color;
                this.alpha = 1;
                this.friction = 0.97;
                this.gravity = 0.05;
                this.decay = Math.random() * 0.015 + 0.005;
                this.size = Math.random() * 2 + 1;
            }

            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 5;
                ctx.shadowColor = this.color;
                ctx.restore();
            }
        }

        function createHeartExplosion(centerX, centerY) {
            const color = colors[Math.floor(Math.random() * colors.length)];
            const particleCount = 125;

            for (let i = 0; i < particleCount; i++) {
                const t = (i / particleCount) * Math.PI * 2;
                const heartX = 16 * Math.pow(Math.sin(t), 3);
                const heartY = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
                const scale = Math.random() * 5 + 8.5;
                const vx = heartX * (scale / 10);
                const vy = heartY * (scale / 10);
                const randomness = 0.25;
                particles.push(new Particle(
                    centerX, centerY, 
                    vx + (Math.random() - 0.5) * randomness, 
                    vy + (Math.random() - 0.5) * randomness, 
                    color
                ));
            }
        }

        function handleInteraction(e) {
            // No disparar fuegos si el modal está abierto
            if (isModalOpen) return;

            let x, y;
            if (e.type === 'touchstart') {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }

            // Iniciar música en la primera interacción si no ha empezado
            if (!musicStarted) {
                bgMusic.play().catch(error => console.log("Audio bloqueado"));
                musicStarted = true;
            }

            createHeartExplosion(x, y);
            showMessage();
        }

        function showMessage() {
            const text = messages[Math.floor(Math.random() * messages.length)];
            messageEl.innerText = text;
            messageEl.classList.add('visible');
            clearTimeout(messageTimeout);
            messageTimeout = setTimeout(() => {
                messageEl.classList.remove('visible');
            }, 3500);
        }

        // --- LÓGICA DE BOTONES Y MODAL ---

        audioControl.addEventListener('click', (e) => {
            e.stopPropagation(); // Importante para no disparar corazón
            if (bgMusic.muted) {
                bgMusic.muted = false;
                iconOn.style.display = 'block';
                iconOff.style.display = 'none';
            } else {
                bgMusic.muted = true;
                iconOn.style.display = 'none';
                iconOff.style.display = 'block';
            }
        });

        letterControl.addEventListener('click', (e) => {
            e.stopPropagation();
            isModalOpen = true;
            letterModal.style.display = 'flex';
            setTimeout(() => letterModal.classList.add('active'), 10);
            
            // Si la música no ha empezado, intentar empezarla al abrir la carta
            if (!musicStarted) {
                bgMusic.play().catch(error => {});
                musicStarted = true;
            }
        });

        function closeLetterModal() {
            letterModal.classList.remove('active');
            setTimeout(() => {
                letterModal.style.display = 'none';
                isModalOpen = false;
            }, 500);
        }

        closeLetter.addEventListener('click', closeLetterModal);
        
        // Cerrar al hacer clic fuera del papel
        letterModal.addEventListener('click', (e) => {
            if (e.target === letterModal) closeLetterModal();
        });

        // Evitar que clics dentro del papel disparen fuegos (redundancia)
        letterPaper.addEventListener('click', (e) => e.stopPropagation());

        // --- BUCLE DE ANIMACIÓN ---

        canvas.addEventListener('mousedown', handleInteraction);
        canvas.addEventListener('touchstart', (e) => {
            if (!isModalOpen) e.preventDefault();
            handleInteraction(e);
        }, { passive: false });

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                p.draw();
                if (p.alpha <= 0) particles.splice(i, 1);
            }
            requestAnimationFrame(animate);
        }

        // Fuegos iniciales
        setTimeout(() => {
            const w = window.innerWidth;
            const h = window.innerHeight;
            createHeartExplosion(w * 0.2, h * 0.3);
            setTimeout(() => createHeartExplosion(w * 0.8, h * 0.3), 500);
        }, 1000);

        animate();
    </script>
</body>
</html>
